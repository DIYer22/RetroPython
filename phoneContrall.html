
<!DOCTYPE html>
<html>
<head>

	<meta charset="UTF-8">
	<title>RetroPython</title>
    <script src="http://apps.bdimg.com/libs/jquery/2.0.0/jquery.min.js"></script>
    <script type="text/javascript" src="http://cdn.bootcss.com/socket.io/1.4.8/socket.io.min.js"></script>
	<!-- // <script src="js/jquery.min.js"></script> -->
	<script src="http://cdn.bootcss.com/dat-gui/0.5.1/dat.gui.js"></script>
	<style>
	p{
		font-size: 50px!important;
	}
	</style>

	<script>



function deepCopy(p, c) {
	var c = c || {};
	for (var i in p) {
		if (typeof p[i] === 'object') {
			c[i] = (p[i].constructor === Array) ? [] : {};
			deepCopy(p[i], c[i]);
		} else {
			c[i] = p[i];
		}
	}
	return c;
}


int = parseInt
float = parseFloat
log = console.log

info = console.info
table = console.table
len=(x)=>x.length
rn = (x)=> int(x*Math.random())
function range (f,n,max) {
	// 1.Python 用法 
	// 2.执行 f(n['property']) 并返回新的 [] 或 {}
	// range(10) =>[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
	// range(x=>x*2,5,10) =>[10, 12, 14, 16, 18]
	// range(x=>x+x,['a', 'b', 'c']) 
	// =>["aa", "bb", "cc"]

	var flag = (typeof f == "number")

	if(flag){
		max =(typeof n == "number")?n:max
		n = f
		f = x=>x
	}
	var items = n
	var obj = (n.constructor === Array)?[]:{}
	if(typeof n == "number"){
		obj = []
		items = []
		var i=max?n:0
		max=max||n
		while(i!=max){items.push(i);i++}
	}
 	
 	for (var i in items) {
 		obj[i]=f(items[i])
 	}
 	return obj
 } 
function debug(x){  //debug
  if (typeof x == 'object'){
  	var str = ''
  	for (var i in x) {
  		str+= i + ':' +x[i]+'<br>'
  	}
  	x=str
  }
  var div = document.getElementById('debug');
  div.innerHTML = x+'<br><br>'+div.innerHTML

}

sum = (arr)=>{
        var summ = 0
        for (var i in arr){
                summ += arr[i]
        }
        return summ
}



var prot = 8080
var ad ='http://' + document.domain + ':'+prot+'/game'
log(ad)
// var socket = io.connect(ad);
// socket.on('response', function(msg) {
//     log('response:' + msg.data);

// })
// socket.on('testLine', function(msg) {
//     log('testLine:' + msg.data);

// })
// socket.emit('testLine',{data:'successed to pi!'})


</script>
</head>

<body>
<p>左右：<span id="alpha">0</span></p>
<p>前后：<span id="beta">0</span></p>
<p>扭转：<span id="gamma">0</span></p>
<p>指北针指向：<span id="heading">0</span>度</p>
<p>指北针精度：<span id="accuracy">0</span>度</p>
<p>x：<span id="x">0</span></p>
<p>y：<span id="y">0</span></p>
<p>z：<span id="z">0</span></p>
<p>a：<span id="a">0</span></p>
<p>r：<span id="r">0</span></p>
<p>t：<span id="t">0</span></p>


<div id="debug" style="width:400px;position:fixed;top:50px;left:60%;background:white;opacity: 0.5" >

</div>

<div id="null" style="width:100%;position:fixed;top:0px;left:100%" ></div>

</body>

<script>
// $(document).keydown(function(event){

// 	if([38,39,40,37].indexOf(event.keyCode)!=-1){
		
// 		event.preventDefault()
// 		var index = [38,39,40,37].indexOf(event.keyCode)
// 		var py = map.pythons[0]
// 		py.button = py.directArr[index]
// 	}
// });

window.addEventListener('touchstart',function(e){
    nStartY = e.targetTouches[0].pageY;
    nStartX = e.targetTouches[0].pageX;
    debug(nStartY,nStartX)
});


window.addEventListener("devicemotion", function(event) {
    document.getElementById("x").innerHTML =int (event.accelerationIncludingGravity.x);
    document.getElementById("y").innerHTML =int (event.accelerationIncludingGravity.y);
    document.getElementById("z").innerHTML =int (event.accelerationIncludingGravity.z);


    document.getElementById("a").innerHTML =event.acceleration.x
    // [event.acceleration.x,event.acceleration.y,event.acceleration.z];
    // document.getElementById("r").innerHTML =int (event.rotationRate);
    document.getElementById("t").innerHTML =int (event.interval);

},true)

function orientationHandler(event) {
    document.getElementById("alpha").innerHTML =int (event.alpha);
    document.getElementById("beta").innerHTML = int (event.beta);
    document.getElementById("gamma").innerHTML = int (event.gamma);
    document.getElementById("heading").innerHTML = event.webkitCompassHeading;
    document.getElementById("accuracy").innerHTML = event.webkitCompassAccuracy;
}
if (window.DeviceOrientationEvent) {
    window.addEventListener("deviceorientation", orientationHandler, true);
} else {
    document.body.innerHTML = "What user agent u r using???";
}


// setInterval(()=>{
// 	socket.emit('buffer', {
// 		data:map.getBuffer()
// 	})
// },1000)
// setInterval(()=>{map.pythons[0].button=['u','r','d','l'][rn(4)]},1000)


//得到点击的坐标  
function getEventPosition(ev){  
    var x, y;  
    if (ev.layerX || ev.layerX == 0) {  
        x = ev.layerX;  
        y = ev.layerY;  
    }else if (ev.offsetX || ev.offsetX == 0) { // Opera  
        x = ev.offsetX;  
        y = ev.offsetY;  
    }  
    return {x: x, y: y};  
}  

</script>

</html>
